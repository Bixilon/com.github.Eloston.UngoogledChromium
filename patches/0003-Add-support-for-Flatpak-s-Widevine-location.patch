From 32b99c98004d3f9e1efdae4b714a6c0f129b58d6 Mon Sep 17 00:00:00 2001
From: Ryan Gonzalez <rymg19@gmail.com>
Date: Wed, 26 Aug 2020 20:23:56 -0500
Subject: [PATCH 03/11] Add support for Flatpak's Widevine location

---
 chrome/common/chrome_paths.cc | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/chrome/common/chrome_paths.cc b/chrome/common/chrome_paths.cc
index b09881641943e..35732e7578b86 100644
--- a/chrome/common/chrome_paths.cc
+++ b/chrome/common/chrome_paths.cc
@@ -380,6 +380,14 @@ bool PathProvider(int key, base::FilePath* result) {
 
 #if defined(OS_LINUX) && BUILDFLAG(BUNDLE_WIDEVINE_CDM)
     case chrome::DIR_BUNDLED_WIDEVINE_CDM:
+      if (sandbox::FlatpakSandbox::GetInstance()->GetSandboxLevel() >
+          sandbox::FlatpakSandbox::SandboxLevel::kNone) {
+        cur = base::FilePath(
+            FILE_PATH_LITERAL("/app/widevine/libwidevinecdm.so"));
+        if (base::PathExists(cur)) {
+          break;
+        }
+      }
       if (!GetComponentDirectory(&cur))
         return false;
 #if !defined(OS_CHROMEOS)
-- 
2.26.2

